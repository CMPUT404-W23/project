{% extends 'base.html' %}
{% block content %}
<div class="container my-4">
  <form>
    <h2 class="border-bottom py-3">Settings</h2>
    {% load tz %}
    <i>Last login: {{ user.last_login|timezone:"America/Edmonton" }} MST</i>
    <div class="my-3">
      <label for="username" class="form-label">Username</label>
      <input type="text" class="form-control" id="username" value={{user.username}}>
    </div>
    <div class="mb-3">
      <label for="email" class="form-label">Email address</label>
      <input type="email" class="form-control" id="email" {% if user.email %} value={{user.email}} {% else %}
        placeholder="Enter your email" {% endif %}>
    </div>
    <div class="mb-3">
      <label for="first-name" class="form-label">First Name</label>
      <input type="text" class="form-control" id="first-name" {% if user.first_name %} value={{user.first_name}} {% else
        %} placeholder="First Name" {% endif %}>
    </div>
    <div class="mb-3">
      <label for="last-name" class="form-label">Last Name</label>
      <input type="text" class="form-control" id="last-name" {% if user.last_name %} value={{user.last_name}} {% else %}
        placeholder="Last Name" {% endif %}>
    </div>
    <h3 class="mt-5">Change Password</h3>
    <div class="mb-3">
      <label for="current-password" class="form-label">Current Password</label>
      <input type="password" class="form-control" id="current-password" placeholder="Enter your current password">
    </div>
    <div class="mb-3">
      <label for="new-password" class="form-label">New Password</label>
      <input type="password" class="form-control" id="new-password" placeholder="Enter new password">
    </div>
    <div class="mb-3">
      <label for="confirm-password" class="form-label">Confirm Password</label>
      <input type="password" class="form-control" id="confirm-password" placeholder="Re-enter new password">
    </div>
    <button type="submit" class="btn btn-primary" onclick="sendUserInfo(event)">Save Changes</button>
  </form>
</div>
{% csrf_token %}
<script>
  function sendUserInfo(e) {
    e.preventDefault();
    const httpRequest = new XMLHttpRequest();
    console.log("Sending user info")
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    httpRequest.onreadystatechange = () => {
      if (httpRequest.readyState === XMLHttpRequest.DONE) {
        if (httpRequest.status === 201) {
          console.log(httpRequest.responseText)
        } else {
          alert(`There was a problem with the request: ${httpRequest.statusText}`);
        }
      }
    };

    const displayName = "testuser"
    const github = "octocat"
    const profileImage = "github.com/octocat.png"
    httpRequest.open("POST", "http://127.0.0.1:8000/api/authors/1/");
    httpRequest.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
    httpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    httpRequest.send(`displayName=${displayName}&github=${github}&profileImage=${profileImage}`);
  }
</script>
{% endblock content %}